webpackJsonp([34],{180:function(t,e,r){r(585);var i=r(1)(r(386),r(518),"data-v-16cd88f5",null);t.exports=i.exports},204:function(t,e,r){t.exports={default:r(206),__esModule:!0}},206:function(t,e,r){var i=r(2),o=i.JSON||(i.JSON={stringify:JSON.stringify});t.exports=function(t){return o.stringify.apply(o,arguments)}},207:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBodyFontSize=e.removeStore=e.getStore=e.setStore=e.setTitle=void 0;var i=r(204),o=function(t){return t&&t.__esModule?t:{default:t}}(i),s=r(208);e.setTitle=function(t){s.DD.setTitle(t)},e.setStore=function(t,e){t&&("string"!=typeof e&&(e=(0,o.default)(e)),window.sessionStorage.setItem(t,e))},e.getStore=function(t){if(t)return window.sessionStorage.getItem(t)},e.removeStore=function(t){t&&window.sessionStorage.removeItem(t)},e.getBodyFontSize=function(){return document.documentElement.style.fontSize.match(/(\d+(?:\.\d+)?)/)[0]||0}},208:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;var i=r(204),o=function(t){return t&&t.__esModule?t:{default:t}}(i),s={setTitle:function(t){dd.ready(function(){dd.ui.webViewBounce.disable(),dd.ui.pullToRefresh.disable(),dd.biz.navigation.setTitle({title:t,onSuccess:function(t){},onFail:function(t){alert(t)}}),dd.biz.navigation.setRight({show:!1})}),dd.error(function(t){alert("dd error: "+(0,o.default)(err))})}};e.DD=s},386:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(207);e.default={components:{},data:function(){return{photo:{},editor:{},imgClient:{width:"",height:""},cropStyle:{},transform:{},cropperImg:{},cropperImgTransform:{x:0,y:0},cropperImgSrc:"",imgData:"",cropWrapper:{width:0,height:0}}},props:{},computed:{},mounted:function(){this.init()},methods:{onMouseWheel:function(){function t(t){return t=t||window.event,(t.wheelDelta?t.wheelDelta<0:t.detail>0)?r.setScaleStyle(r.editor.scale-.1):r.setScaleStyle(r.editor.scale+.1),t.preventDefault&&t.preventDefault(),!1}function e(t,e,r){t.attachEvent?t.attachEvent("on"+e,r):t.addEventListener(e,r,!1)}var r=this,i=this.$refs.cropperMove;e(i,"mousewheel",t),e(i,"DOMMouseScroll",t)},init:function(){if(this.imgData=this.getImgData(),!this.imgData.img_src)return console.log("获取图片失败，请重试"),!1;this.render(),this.setPhotoParams(),this.onMouseWheel()},render:function(){this.imgDataB=this.imgData.crop_w/750,this.imgData.crop_w=this.imgData.crop_w*this.imgDataB,this.imgData.crop_h=this.imgData.crop_h*this.imgDataB,this.cropperImgSrc=this.imgData.img_src},getImgBase64:function(t){var e=this,r=new Image;r.src=result,r.onload=function(){e.imgOnload(this)};var i=document.createElement("canvas"),o=i.getContext("2d");return i.width=t.img_w,i.height=t.img_h,o.drawImage(t,0,0,t.img_w,t.img_h),i.toDataURL("image/jpeg",.8)},getImgData:function(){var t=(0,i.getStore)("photoEditor")||"";return t?JSON.parse(t):{}},getCropParams:function(t,e,r,i){var o=void 0,s=void 0;return t>=r?(o=r,(s=e*(r/t))>i&&(o*=i/s,s=i)):(o=t,(s=e)>i&&(o*=i/s,s=i)),{width:o,height:s}},setPhotoParams:function(){var t=this.$refs.canvas,e=this.$refs.cropperViewImg,r=this.$refs.cropperWrapImg,i=this.$refs.cropperWrap;this.canvasClient={width:t.clientWidth,height:t.clientHeight},this.cropWrapper=this.getCropParams(this.imgData.crop_w,this.imgData.crop_h,this.canvasClient.width,this.canvasClient.height),this.cropperImg=this.getCropParams(this.imgData.img_w,this.imgData.img_h,this.canvasClient.width,this.canvasClient.height);var o=this.cropperImg.width<this.canvasClient.width?(this.canvasClient.width-this.cropperImg.width)/2:0,s=this.cropperImg.height<this.canvasClient.height?(this.canvasClient.height-this.cropperImg.height)/2:0,n=(this.canvasClient.width-this.cropWrapper.width)/2,a=(this.canvasClient.height-this.cropWrapper.height)/2,p=o-n,h=s-a;this.cropperImgTransform={x:p,y:h,cy:h,cx:p},r.style.height=e.style.height=this.cropperImg.height+"px",r.style.width=e.style.width=this.cropperImg.width+"px",this.cropStyle={transform:"translate("+n+"px,"+a+"px)",height:this.cropWrapper.height+"px",width:this.cropWrapper.width+"px"},i.style.webkitTransform="translate("+o+"px,"+s+"px)",e.style.webkitTransform="translate("+this.cropperImgTransform.x+"px,"+this.cropperImgTransform.y+"px)",this.transform={scale:1,x:o,y:s},this.setEditorInit()},setEditorInit:function(){this.photo={startX:0,startY:0,endX:0,endY:0},this.editor={startX1:"",startX2:"",startY1:"",startY2:"",moveY1:"",moveY2:"",strtSqrt:"",moveSqrt:"",startX:"",endX:"",fingers:"",transformX:0,transformY:0}},start:function(t){var e=t.touches[0],r=t.touches[1];this.editor.startX2="",this.editor.startY2="",this.editor.strtSqrt="",this.editor.transformX=0,this.editor.transformY=0,this.editor.cropperImgTransformX=0,this.editor.cropperImgTransformY=0,this.editor.startX1=e.pageX||"",this.editor.startY1=e.pageY||"",this.editor.fingers=1,this.editor.scale=1,t.touches.length>=2&&(this.editor.fingers=2,this.editor.startX2=r.pageX||"",this.editor.startY2=r.pageY||"",this.editor.strtSqrt=this.getSqrt(e.pageX,e.pageY,r.pageX,r.pageY))},move:function(t){t.stopPropagation();var e=t.touches[0],r=t.touches[1];this.editor.moveX1=e.pageX||"",this.editor.moveY1=e.pageY||"",t.touches.length>=2&&(this.editor.fingers=2),2===this.editor.fingers?r&&(this.editor.strtSqrt?(this.editor.moveSqrt=this.getSqrt(e.pageX,e.pageY,r.pageX,r.pageY),this.setScaleStyle(this.editor.moveSqrt/this.editor.strtSqrt)):(this.editor.startX2=r.pageX||"",this.editor.startY2=r.pageX||"",this.editor.strtSqrt=this.getSqrt(e.pageX,e.pageY,r.pageX,r.pageY))):this.setTranslateStyle(e.pageX-this.editor.startX1,e.pageY-this.editor.startY1)},setScaleStyle:function(t){this.editor.scale=t,this.editor.cropperImgHeight=this.cropperImg.height*t,this.editor.cropperImgwidth=this.cropperImg.width*t,this.$refs.cropperWrapImg.style.height=this.$refs.cropperViewImg.style.height=this.editor.cropperImgHeight+"px",this.$refs.cropperWrapImg.style.width=this.$refs.cropperViewImg.style.width=this.editor.cropperImgwidth+"px"},setTranslateStyle:function(t,e){this.editor.transformX=this.transform.x+(t||0),this.editor.transformY=this.transform.y+(e||0),this.editor.cropperImgTransformX=this.cropperImgTransform.x+(t||0),this.editor.cropperImgTransformY=this.cropperImgTransform.y+(e||0),this.$refs.cropperWrap.style.webkitTransform="translateX("+this.editor.transformX+"px) translateY("+this.editor.transformY+"px)",this.$refs.cropperViewImg.style.webkitTransform="translateX("+this.editor.cropperImgTransformX+"px) translateY("+this.editor.cropperImgTransformY+"px)"},end:function(){this.transform.x=0!==this.editor.transformX?this.editor.transformX:this.transform.x,this.transform.y=0!==this.editor.transformY?this.editor.transformY:this.transform.y,this.cropperImgTransform.x=0!==this.editor.cropperImgTransformX?this.editor.cropperImgTransformX:this.cropperImgTransform.x,this.cropperImgTransform.y=0!==this.editor.cropperImgTransformY?this.editor.cropperImgTransformY:this.cropperImgTransform.y,console.log(this.editor.scale),1!==this.editor.scale&&(this.cropperImg.height=this.editor.cropperImgHeight,this.cropperImg.width=this.editor.cropperImgwidth),this.saveCropperImg()},getSqrt:function(t,e,r,i){var o=t-r,s=e-i;return Math.sqrt(o*o+s*s)},saveCropperImg:function(){this.$store.commit("updateLoadingStatus",{show:!0,tips:"图片裁剪中 请稍后"});var t=this.$refs.cropperViewImg,e=this.imgDataB,r=this.cropperImg.height,o=this.cropperImg.width,s=this.imgData.crop_w,n=this.imgData.crop_h,a=this.cropperImgTransform.x,p=this.cropperImgTransform.y,h=document.createElement("canvas"),c=this.imgData.crop_w/this.cropWrapper.width;h.width=s/e,h.height=n/e,console.log(o/e,r/e),h.getContext("2d").drawImage(t,a/e,p/e,o/e*c,r/e*c),(0,i.setStore)("photoEditorEd",{img_w:s/e,img_h:n/e,img_src:h.toDataURL()}),this.$store.commit("updatePhotoEditorEd",!0),this.$router.go(-1)}}}},425:function(t,e,r){e=t.exports=r(11)(),e.push([t.i,"\n.photo-editor-wrapper[data-v-16cd88f5] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n    background: #7F7F7F;\n}\n.canvas[data-v-16cd88f5] {\n    -ms-flex-align: center;\n    align-items: center;\n    display: -ms-flexbox;\n    display: flex;\n    height: 100%;\n    -ms-flex-pack: center;\n    justify-content: center;\n    overflow: hidden;\n}\n.cropper-container[data-v-16cd88f5] {\n    font-size: 0;\n    line-height: 0;\n    position: relative;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    direction: ltr;\n    -ms-touch-action: none;\n    touch-action: none;\n    width: 100%;\n    height: 100%;\n}\n.cropper-wrap-box[data-v-16cd88f5] {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n}\n.cropper-canvas[data-v-16cd88f5] {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n}\n.cropper-container img[data-v-16cd88f5] {\n    display: block;\n    min-width: 0 !important;\n    max-width: none !important;\n    min-height: 0 !important;\n    max-height: none !important;\n    width: 100%;\n    height: 100%;\n    image-orientation: 0deg;\n}\n.cropper-modal[data-v-16cd88f5] {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    opacity: .5;\n    background-color: #000;\n}\n.cropper-drag-box[data-v-16cd88f5] {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n}\n.cropper-crop-box[data-v-16cd88f5] {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    background: rgba(255, 255, 255, .4);\n}\n.cropper-view-box[data-v-16cd88f5] {\n    display: block;\n    overflow: hidden;\n    width: 100%;\n    height: 100%;\n}\n.cropper-move[data-v-16cd88f5] {\n    opacity: 0;\n    background-color: #fff;\n    cursor: move;\n}\n",""])},518:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"photo-editor-wrapper"},[r("div",{ref:"canvas",staticClass:"canvas"},[r("div",{staticClass:"cropper-container"},[r("div",{staticClass:"cropper-wrap-box"},[r("div",{ref:"cropperWrap",staticClass:"cropper-canvas"},[r("img",{ref:"cropperWrapImg",style:t.cropperImg,attrs:{src:t.cropperImgSrc}})])]),t._v(" "),r("div",{staticClass:"cropper-drag-box cropper-modal"}),t._v(" "),r("div",{staticClass:"cropper-crop-box",style:t.cropStyle},[r("div",{staticClass:"cropper-view-box"},[r("img",{ref:"cropperViewImg",style:t.cropperImg,attrs:{src:t.cropperImgSrc}})])]),t._v(" "),r("div",{ref:"cropperMove",staticClass:"cropper-drag-box cropper-move",on:{touchstart:function(e){e.preventDefault(),t.start(e)},touchmove:function(e){e.preventDefault(),t.move(e)},touchend:function(e){e.preventDefault(),t.end(e)}}})])])])},staticRenderFns:[]}},585:function(t,e,r){var i=r(425);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);r(12)("ab0e16aa",i,!0)}});